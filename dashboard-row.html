<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/polymer-sortablejs/polymer-sortablejs.html" />
<link rel="import" href="dashboard-panel.html">
<dom-module id="dashboard-row">
    <template>
      <style>
        :host{
          border-collapse: collapse;
          width: 100%;
          display: inline-block;
        }
        body {
        padding: 20px;
        }
        .list-group-item {
          cursor: move;
          cursor: -webkit-grabbing;
        }
      </style>
      <div>
        <template is="dom-if" if="[[row.showTitle]]">
          <h2 id="show">[[row.title]]</h2>
        </template>
    <sortable-js>
        <template is="dom-repeat" items="{{row.panels}}">
          <div>
            <dashboard-panel refresh="[[refresh]]" datasource-uri="[[_datasourceUri(datasources, item)]]" rowh="{{row.height}}" panel="{{item}}" from="[[from]]" to="[[to]]" id="panel-[[item.id]]" style="width: [[_elementWidth(item.span)]]; display: block;"></dashboard-panel>
          </div>
        </template>
    </sortable-js>
    </div>
    </template>
    <script>
        Polymer({
            is: 'dashboard-row',

            properties: {
                row: {
                    type: Object,
                    notify: true
                },
                title: String,
                from: String,
                to: String,
                datasources: Array,
                refresh: String,
            },
            _elementWidth: function(span) {
                return 100 * span / 12 + '%';
            },
            _datasourceUri: function(datasources, panel) {
                if (panel && panel.datasource) {
                    var prefix = '/api/datasources/proxy/';
                    //graphite has a datasource object that has datasource.name
                    for (var i = 0; i < datasources.length; i++) {
                        if (panel.datasource != undefined) {
                            var prefix = '/api/datasources/proxy/';
                            if (panel.datasource == datasources[i].name) {
                                return datasources[i].uri || prefix + datasources[i].id;
                            }
                        }
                        // influx has panel.datasource for the name only
                        else {
                            var prefix = '/api/datasources/proxy/';
                            if (panel.datasource == datasources[i].name) {
                                return datasources[i].uri || prefix + datasources[i].id;
                            }
                        }
                    }
                }
            }
        });
    </script>
</dom-module>
